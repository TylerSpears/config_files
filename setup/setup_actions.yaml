actions:
  pre:
    debian-setup: | 
      mkdir --parents {{@@ env['HOME'] @@}}/bin
      if ! sh -c 'xargs --arg-file "{{@@ env['HOME'] @@}}/dotfiles/setup/apt_pkglist" dpkg-query -W' >/dev/null 2>&1 ; then
        sync
        sudo apt -qq update
        xargs --arg-file="{{@@ env['HOME'] @@}}/dotfiles/setup/apt_pkglist" sudo apt -y install
      fi

    nbdime-install: |
      if ! command -v nbdime ; then
        pip install --upgrade --quiet nbdime
      fi

    dsf-install: |
      if ! command -v diff-so-fancy ; then
        wget \
          https://raw.githubusercontent.com/so-fancy/diff-so-fancy/master/third_party/build_fatpack/diff-so-fancy \
          --output-document {{@@ env['HOME'] @@}}/bin/diff-so-fancy
        chmod +x {{@@ env['HOME']@@}}/bin/diff-so-fancy
      fi

    rust-install: |
      if ! command -v cargo ; then
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs -o {{@@env['HOME'] @@}}/rustup.sh
        sh {{@@ env['HOME'] @@}}/rustup.sh --quiet --no-modify-path -y
        rm {{@@ env['HOME'] @@}}/rustup.sh
        . {{@@ env['HOME'] @@}}/.cargo/env
      fi

    z-install: |
      if ! command -v z.sh ; then
        wget \
          https://raw.githubusercontent.com/rupa/z/master/z.sh \
          --output-document {{@@ env['HOME'] @@}}/bin/z.sh
        chmod +x {{@@ env['HOME'] @@}}/bin/z.sh
      fi

    tmux-install: |
      if test ! -d {{@@ env['HOME'] @@}}/.tmux/plugins/tpm ; then
        git clone https://github.com/tmux-plugins/tpm {{@@ env['HOME'] @@}}/.tmux/plugins/tpm
      fi
      {{@@ env['HOME'] @@}}/.tmux/plugins/tpm/bin/install_plugins

  post:
    nbdime-vcs-setup: nbdime config-git --enable --global
    vim-plug-setup: vim +PlugInstall +qall

