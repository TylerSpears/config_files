actions:
  pre:
    debian-setup: | 
      mkdir --parents {{@@ env['HOME'] @@}}/bin
      if ! xargs --arg-file "{{@@ env['HOME'] @@}}/dotfiles/setup/apt_pkglist" dpkg-query -W &>/dev/null ; then
        sudo apt -qq update
        xargs --arg-file="{{@@ env['HOME'] @@}}/dotfiles/setup/apt_pkglist" sudo apt -y install
      fi

    nbdime-install: pip install --upgrade --quiet nbdime
    dsf-install: |
      if ! command -v diff-so-fancy ; then
        wget \
          https://raw.githubusercontent.com/so-fancy/diff-so-fancy/master/third_party/build_fatpack/diff-so-fancy \
          --output-document {{@@ env['HOME'] @@}}/bin/diff-so-fancy
        chmod +x {{@@ env['HOME']@@}}/bin/diff-so-fancy
      fi

    rust-install: |
      if ! command -v cargo ; then
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs -o {{@@env['HOME'] @@}}/rustup.sh
        sh {{@@ env['HOME'] @@}}/rustup.sh --quiet --no-modify-path -y
        rm {{@@ env['HOME'] @@}}/rustup.sh
        tail {{@@ env['HOME'] @@}}/.cargo/env
      fi

    z-install: |
      if ! command -v z.sh ; then
        wget \
          https://raw.githubusercontent.com/rupa/z/master/z.sh \
          --output-document {{@@ env['HOME'] @@}}/bin/z.sh
        chmod +x {{@@ env['HOME'] @@}}/bin/z.sh
      fi

  post:
    nbdime-vcs-setup: nbdime config-git --enable --global
    vim-plug-setup: vim +PlugInstall +qall

